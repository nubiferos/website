{{- $url := .Destination -}}
{{- $text := .Text -}}
{{- $title := .Title -}}

{{- /* Check if external link */ -}}
{{- $isExternal := or (hasPrefix $url "http://") (hasPrefix $url "https://") -}}

{{- if $isExternal -}}
<a href="{{ $url }}"{{ with $title }} title="{{ . }}"{{ end }} target="_blank" rel="noopener noreferrer">{{ $text }}</a>
{{- else -}}
{{- /* For internal links starting with /, prepend site base path */ -}}
{{- $finalURL := $url -}}
{{- if hasPrefix $url "/" -}}
{{- $finalURL = printf "%s%s" (strings.TrimSuffix "/" .Page.Site.BaseURL | urls.Parse).Path $url -}}
{{- end -}}
<a href="{{ $finalURL }}"{{ with $title }} title="{{ . }}"{{ end }}>{{ $text }}</a>
{{- end -}}
